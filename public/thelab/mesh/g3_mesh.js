/**
* G3 Mesh
* A technical demo
* Made by Stefan Goodchild (@stefangoodchild)
*/function G3MeshUi(){var a=[],b=[],d=g3.svg.group(g3_mesh.svg,{id:"connections"}),e=!1,f,g,h=function(){for(var h=0;h<Math.floor(g3_mesh.perf-5)+3;h++)a.push(new G3MeshDisc(h));var i=0;g3.utils.each(a,function(e,f){for(var g=i;g<g3.utils.objLength(a);g++)if(g!==e){c=new G3MeshConnection(a[e],a[g],d);b.push(c)}i++});if(g3.utils.is_touch_device()){g3.utils.each(a,function(a,b){b.dot().addEventListener("touchstart",function(a){e=!0;f=this},!1)});g3_mesh.svg.addEventListener("touchmove",function(a){if(e===!0){a.preventDefault();npos=g(a.pageX,a.pageY,g3_mesh.el);f.parentNode.setAttributeNS(null,"transform","translate("+npos.x+","+npos.y+")");g3.utils.each(b,function(a,b){b.match_disc(f)&&b.update_start()})}},!1);g3_mesh.svg.addEventListener("touchend",function(a){e=!1},!1)}else{g3.utils.each(a,function(a,b){b.dot().addEventListener("mousedown",function(a){e=!0;f=this},!1)});g3_mesh.svg.addEventListener("mousemove",function(a){if(e===!0){npos=g(a.pageX,a.pageY,g3_mesh.el);f.parentNode.setAttributeNS(null,"transform","translate("+npos.x+","+npos.y+")");g3.utils.each(b,function(a,b){b.match_disc(f)&&b.update_start()})}},!1);g3_mesh.svg.addEventListener("mouseup",function(a){e=!1},!1)}},g=function(a,b,c){var d=a-c.offset().left,e=b-c.offset().top;return{x:d,y:e}};this.discs=function(){return a};this.connections=function(){return b};h()}function G3MeshDisc(a){var b,c=Math.random(0,1)*g3_mesh.el.width(),d=Math.random(0,1)*g3_mesh.el.height(),e,f,g=function(){b=g3.svg.group(g3_mesh.svg,{id:"disc_"+a,transform:"translate("+c+","+d+")"});e=Math.random()*5+10;f=g3.svg.circle(b,0,0,e,{id:"disc_"+a,fill:"#2C96CA",stroke:"#2e2e2e","stroke-width":1,"stroke-opacity":.5,cursor:"pointer"});h(e);h(e+15);Math.random()*2-1>0&&h(e+30);return b},h=function(a){var c=g3.svg.group(b),d=g3.svg.rotateLoop(c,Math.random()*5+5,Math.random()*2-1),e,f,g,h;a=a+5+Math.random()*20;var i=Math.random()*2-1+10,j=Math.round(Math.random()+1),k=Math.round(Math.random()*3+1);for(var l=0;l<360;l+=10){e=a*Math.cos(l*(Math.PI/180));f=a*Math.sin(l*(Math.PI/180));g=a*Math.cos((l+k)*(Math.PI/180));h=a*Math.sin((l+k)*(Math.PI/180));g3.svg.line(c,e,f,g,h,{stroke:"#fff","stroke-width":j,"stroke-opacity":.2})}};this.dot=function(){return f};this.disc=function(){return b};this.loc=function(){return{x:c,y:d,r:e}};this.set_loc=function(a,b,e){c=a;d=b;if(e)return loc};g()}function G3MeshConnection(a,b,c){var d=g3.utils.getVector(a.loc(),b.loc()),e=g3.utils.map(d.length,0,300,.5,0),f,g,h=function(){g=g3.svg.line(c,a.loc().x,a.loc().y,b.loc().x,b.loc().y,i())},i=function(){d.length<150?f={stroke:"#2C96CA","stroke-width":1+(4-d.length/50),"stroke-opacity":1}:f={stroke:"#ccc","stroke-width":1,"stroke-opacity":e};return f};this.update_start=function(){var c=a.disc().getAttribute("transform").replace(/[a-z]+\(*(.+)\)/,"$1").split(","),f=b.disc().getAttribute("transform").replace(/[a-z]+\(*(.+)\)/,"$1").split(",");a.set_loc(c[0],c[1],!1);b.set_loc(f[0],f[1],!1);g.setAttribute("x1",c[0]);g.setAttribute("y1",c[1]);g.setAttribute("x2",f[0]);g.setAttribute("y2",f[1]);d=g3.utils.getVector(a.loc(),b.loc());e=g3.utils.map(d.length,0,300,.5,0);g3.svg.setAttributes(g,i())};this.match_disc=function(c){return c==a.dot()?!0:c==b.dot()?!0:!1};h()}var g3_mesh={};$(document).ready(function(){g3_mesh.init($("#lab"),"thelab/mesh/")});g3_mesh.init=function(a,b){g3_mesh.url=b;g3_mesh.el=a;g3_mesh.perf=g3.svg.perf.test();if(g3_mesh.svg=g3.svg.create(g3_mesh.el.attr("id")))g3_mesh.ui=new G3MeshUi;g3_mesh.svg.setAttribute("style","background-color: #2e2e2e")};